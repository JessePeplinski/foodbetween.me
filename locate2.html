<!DOCTYPE html>
<html>

<head>
    <title>Find a Restaurant Between Two Home Addresses</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAE_VuZoJdrJOIN-ccFzTAiXEhPS2oV9M4&libraries=places"></script>
    <script>
        function findRestaurantWithDistanceMatrixAPI() {
            var address1 = document.getElementById('address1').value;
            var address2 = document.getElementById('address2').value;

            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({ 'address': address1 }, function (results1, status1) {
                if (status1 === 'OK') {
                    var latlng1 = results1[0].geometry.location;

                    geocoder.geocode({ 'address': address2 }, function (results2, status2) {
                        if (status2 === 'OK') {
                            var latlng2 = results2[0].geometry.location;

                            var midLat = (latlng1.lat() + latlng2.lat()) / 2;
                            var midLng = (latlng1.lng() + latlng2.lng()) / 2;
                            var midpoint = new google.maps.LatLng(midLat, midLng);

                            var service = new google.maps.places.PlacesService(document.createElement('div'));
                            service.nearbySearch({
                                location: midpoint,
                                radius: 5000,
                                type: ['restaurant']
                            }, function (results, status) {
                                if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {

                                    var restaurantLocations = results.map(function (restaurant) {
                                        return restaurant.geometry.location;
                                    });

                                    var distanceService = new google.maps.DistanceMatrixService();
                                    distanceService.getDistanceMatrix({
                                        origins: [address1, address2],
                                        destinations: restaurantLocations,
                                        travelMode: 'DRIVING'
                                    }, function (response, status) {
                                        if (status === 'OK') {
                                            var rows = response.rows;
                                            var equidistantRestaurants = [];

                                            for (var i = 0; i < restaurantLocations.length; i++) {
                                                var distanceToAddress1 = rows[0].elements[i].distance.value;
                                                var distanceToAddress2 = rows[1].elements[i].distance.value;
                                                var distanceDifference = Math.abs(distanceToAddress1 - distanceToAddress2);

                                                if (distanceDifference < 2000) {
                                                    equidistantRestaurants.push({
                                                        details: results[i],
                                                        distanceToAddress1: rows[0].elements[i].distance.text,
                                                        distanceToAddress2: rows[1].elements[i].distance.text
                                                    });
                                                }
                                            }

                                            if (equidistantRestaurants.length > 0) {
                                                equidistantRestaurants.sort((a, b) => b.details.rating - a.details.rating);
                                                var topRestaurants = equidistantRestaurants.slice(0, 3);

                                                var resultsDiv = document.getElementById('results');
                                                resultsDiv.innerHTML = '';
                                                topRestaurants.forEach(function (restaurant) {
                                                    resultsDiv.innerHTML += '<p><strong>' + restaurant.details.name + '</strong><br>Rating: ' + restaurant.details.rating + '<br>Distance from ' + address1 + ': ' + restaurant.distanceToAddress1 + '<br>Distance from ' + address2 + ': ' + restaurant.distanceToAddress2 + '</p>';
                                                });
                                            } else {
                                                alert('No equidistant restaurants found!');
                                            }

                                        } else {
                                            alert('Distance Matrix request failed: ' + status);
                                        }
                                    });

                                } else {
                                    alert('No restaurants found near the midpoint!');
                                }
                            });

                        } else {
                            alert('Error geocoding second address: ' + status2);
                        }
                    });

                } else {
                    alert('Error geocoding first address: ' + status1);
                }
            });
        }
    </script>
</head>

<body>
    <input id="address1" type="text" placeholder="Enter first address">
    <input id="address2" type="text" placeholder="Enter second address">
    <button onclick="findRestaurantWithDistanceMatrixAPI()">Find Restaurant</button>
    <div id="results"></div>
</body>

</html>
